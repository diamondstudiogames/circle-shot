# Создание карты

В этом руководстве описан процесс создания карты для события.

## Основная инструкция

1. Определитесь с событием, для которого Вы будете создавать карту.
2. Создайте папку `game/maps/<выбранное событие>/<имя карты>`. Название папки карты должно быть написано в *snake_case*.
3. Унаследуйтесь от сцены `game/events/<выбранное событие>/base_map.tscn` и сохраните новую сцену в `game/maps/<выбранное событие>/<имя карты>/<имя карты>.tscn`.
4. Сделайте эту сцену из прототипа непосредственно картой. Для этого хорошо подойдут `TileMapLayer`. Границы, в пределах которой нужно разместить контент, будут видны в качестве фиолетовых полос в редакторе.
    - Для примера построения вы можете посмотреть структуру других карт, и даже скопировать `TileMapLayer` в сцену своей карты, а `TileSet` с текстурами - в её папку. Не забудьте отредактировать зависимости скопированных ресурсов!
    - При рисовании не забывайте про советы в [`drawing.md`](./drawing.md).
5. Скорее всего в `base_map.tscn` были расположены дополнительные узлы - точки появления игроков, аптечек, т.д. Не забудьте их передвинуть под нужды Вашей карты.
6. После того, как карта будет создана, отредактируйте `MinimapTiles`, чтобы он реплицировал Вашу карту на её мини-версии. Самый светлый блок из `TileSet` - стена, чуть темнее - простреливаемая стена, ещё немного темнее - пол, черный тайл - граница карты.
7. Запустите сцену карты (клавиша F6) и сделайте её скришот в разрешении 784 на 160.
    - Для удобства постановки кадра Вы можете *переопределить камеру игры* с помощью кнопки в виде камеры на панели инструментов в редакторе. После её нажатия камера в игре будет в том же положения и зуме, что и камера редактора.
    - Также для удобства непосредственного создания скриншота Вы можете поменять размер окна через `Настройки проекта -> Display -> Window -> Window Width/Height Override`, а потом просто сделать снимок активного окна игры с картой (без декораций окна, естественно).
8. Получив скриншот, положите его в папку карты и назовите его `image.png`.
9. Создайте ресурс типа `MapData` с именем `<имя карты>.tres` в папке Вашей карты. Заполните название и краткое описание. В поле `Scene Path` перетащите сцену Вашей карты, а в `Image Path` - `image.png`.
10. Откройте `*.tres` файл события, для которого эта карта предназначена. В массив `Maps` добавьте файл `*.tres` Вашей карты.
11. Готово! Теперь карта доступна для выбора в игре.

## Детали

- Вы можете использовать существующие элементы (текстуры, тайлы) из содержимого каталога `game/locations`.
- Если же Вы создаёте новой контент, располагайте его в одной из подпапок `game/locations`, кроме случаев, когда Вы точно уверены, что создаваемый контент не будет использован в других местах.
- Для создания форм столкновений карты предусмотрено 3 физических слоя: `world`, `fence` и `boundary`. Для подробностей см. [`achitecture.md`](../architecture.md#физика).
- Рекомендуемая структура `TileMapLayer`:
    - `Floor`: чаще всего содержит тайлы без физической формы, служит как бы фоном карты.
    - `Walls`: скелет карты, её основной каркас, нарисованный тайлами стен.
    - `Top`: декорации, что будут поверх происходящего. Использование тайлов с физическими формами на этом слою не рекомендуется.
- Создавайте границу из блоков с слоем физики `boundary` **за** границей карты так, чтобы игрок и пули не могли выйти за указанные в базовой карте границы.
- Размещение точек появления должно учитывать размер игрока и небольшую случайность их размещения (смотри `Event.spawn_point_randomness`).
- За границами карты продолжайте строительство ещё 16 блоков влево и вправо и 10 блоков вверх и вниз - чтобы игроки даже с самыми широкими/высокими экранами не видели конца карты.
